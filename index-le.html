<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Until what age do women in different countries survive?</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script>
		<script src="./lib/chosen.jquery.js" type="text/javascript"></script>
		<script src="./lib/prism.js" type="text/javascript" charset="utf-8"></script>
		<script src="./lib/d3.v3.js"></script>
		<script src="./lib/nv.d3.js"></script>

		<link  href="./lib/nv.d3.css" rel="stylesheet" type="text/css">
		<link  href="./lib/chosen.css" rel="stylesheet" type="text/css">
	</head>

	<style>
	    
	    #country-box {
	    margin-left: 80px;
	    float: none;
	    color: gray;
	     }


	    h1 {
	    font: 24px sans-serif;
	    color: gray;
	    margin-left: 80px;
	    margin-bottom: -110px;
	    }
    </style>

	<body>
	
	<h1>Life Expectancy By region</h1>

	<svg id="first" style="height:600px; width: 580px"/>

	<script>

	//Global variables for passing filtered data

	var data;

	d3.csv("life-expectancy.csv", function(error, csv) {

		csv = csv.map( function (d) { 
		return { 
	      region: d.region,
	      year: d.year,
	      lex: +d.lex
	      }; 
	  	}); 

	  	csv = d3.nest()
		  .key(function(d) { return d.region; })
		  .sortKeys(d3.ascending)
		  .entries(csv)
		  .map(function(d) {
		    var region = d.key
		    var values = d.values.map(function(dd) {      
		      return {x: dd.year, y: dd.lex}
		    })
		    return {'key':region, 'values':values}
		 });
		
		data = csv;
		draw();
	});

	

	function draw() {

		$("#first").empty();

		nv.addGraph(function() {

		var chart = nv.models.lineChart();

		chart.yAxis
			.axisLabel("Life Expectacny")
			.tickFormat(d3.format("d"));

		chart.forceY([0,85]); 

		chart.margin({left: 80});

		chart.interpolate("basis");

		d3.select("#first")
			.datum(data)
		.transition().duration(300)
			.call(chart);

		nv.utils.windowResize(
				function() {
					chart.update();
				}
			);

		d3.select(".nv-legendWrap")
  			.attr("transform", "translate(10,250)")
  			.on("click", function() { 
  					d3.select(".nv-legendWrap")
  						.attr("transform", "translate(10,250)"); 
  					});

		});

	}

	

	</script>

	</body>
</html>